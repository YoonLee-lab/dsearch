#!/usr/bin/env bash
## List current playlist
#  I generally have all of my music on the playlist
#  Adjust for your own needs


load() {
	local i=0
		mpc playlist | while read -r title; do
		printf '%s %s\n' "$((++i))" "$title"
	done | dmenu -p "Select song: "
}
## Main

if [[ $1 ]]; then
	result=$1
else
	result="$(load)"
fi

[[ $result ]] || exit 0

# If we don't have the song at all, grab it from youtube
if ! mpc playlist | grep "${result#*\ }"; then
	youtube-dl "ytsearch:$result" --get-url --audio-format mp3 -f 140 | mpc insert
	mpc next
else
	mpc play "${result%%\ *}"
	sleep 2
	if ! pgrep mpg123; then
		stream
	fi
fi
